
\section{Properties of Optimal Recolorings}
\label{sec:path_recoloring}

In this section we introduce a special type of convex recoloring,
called \emph{path-recoloring}. 
%
Path-recolorings are more constrained than general recolorings and thus are simpler to
understand and analyze.
%
Nevertheless, 
we show that there is always an optimal convex recoloring that is a path-recoloring.
%
Based on the above, 
we give an alternative definition to \TWOCR{} in terms of independent set of paths.
%
From now on, we only consider the \TWOCR{} problem,
in particular, 
whenever we mention a colored graph, 
we refer to a \TWOCR{} instance.

Given a colored graph $G_\chi$, 
if two vertices in the colored graph have the same color we call them a \emph{pair}, 
if they are connected with an edge then they are a \emph{connected pair}, 
otherwise they are a \emph{disconnected pair}.  
%
Any vertex with a unique color $c$ is a \emph{singleton}, 
we call $c$ a \emph{singleton color}.
%
We denote by $G_\chi[c]$ the subgraph induced by the set of vertices $\{v : \chi(v) = c\}$.
%
Figure~\ref{fig:concepts} depicts these concepts.


\begin{figure}[t]
\centering
\begin{tikzpicture}

\node(1) at (0, 0) [colored node, red node] {1};
\node(2) at (1, -1) [colored node, red node] {2};
\node(3) at (-1, -1) [colored node, blue node] {3};
\node(4) at (-1, 1) [colored node, blue node] {4};
\node(5) at (1, 1) [colored node, green node] {5};

\draw (1) -- (2);
\draw (1) -- (4);
\draw (1) -- (3);
\draw (1) -- (5);

\end{tikzpicture}
\caption{
	\label{fig:concepts}
	In this colored graph, vertex 5 is a singleton, vertices 1 and 2
	are a \emph{connected pair}, and vertices 3 and 4 are a disconnected pair.
}
\end{figure}

%%%%%

\subsection{Path-Recoloring}

As a first step we show that it may be assumed that all 
colors retain at least one representative.
%
In other words,
we show that there is always an optimal convex recoloring $\chi'$ 
that does not recolor singletons and recolors at most one vertex of every pair. 

Given a colored graph $G_\chi$ and a recoloring $\chi'$, 
a vertex $v$ \emph{retains} its color if $\chi(v)=\chi'(v)$. 
%
We say that $\chi'$ \emph{retains} a pair $p$, 
if both vertices of $p$ retains their color.  
%
The recoloring $\chi'$ \emph{retains} a color $c \in C$,
if there exists a vertex $v \in G$ such that ${\chi'(v) = \chi(v) = c}$
\footnote{
Note that this definition is a different than the one given in~\cite{kanj2009convex}.
}.
%
If a recoloring retains all the colors of a graph, 
we refer to it as a \emph{retains-all} recoloring.
Observe that a retains-all recoloring does not recolor singletons.
%
We show that there exists a retains-all optimal recoloring.

\begin{lemma}
\label{lm:retains-all}
For every colored graph $G_\chi$, 
there exists a retains-all optimal convex recoloring.
\end{lemma}

\begin{proof}
Consider an optimal convex recoloring $\chi'$ that retains a maximum
number of colors over all optimal, 
convex recolorings of $G$.
%
Assume for contradiction that $\chi'$ does not retain a color $c$, 
and let $v$ be a vertex such that $\chi(v) = c$ and $\chi'(v) = c' \neq c$.
%
Without loss of generality we assume that $c$ is not used by $\chi'$ 
(otherwise, we can recolor each vertex in $G_{\chi'}[c]$ using a new unique color%
\footnote{
Unique colors are used for simplicity. 
The new colors can be replaced by original colors, 
by iteratively recoloring a vertex with unique color 
using the color of an adjacent vertex which is colored by an original color
}).
%
We define a recoloring $\chi''$ by considering $G_{\chi'}[c']$.
%
First, 
define $\chi''(v) = c$.
Next, 
if $G_{\chi'}[c']$ contains a vertex $u$ such that $\chi(u) = c'$, 
then define $\chi''(u) = c'$.
%
Each vertex of the remaining vertices in $G_{\chi'}[c']$ is colored by $\chi''$ 
using a unique new color.
%
Observe that if there exists a second vertex 
$u' \neq u$ such that $\chi'(u') = \chi(u') = c'$, 
then $\chi"$ recolors it.
%
Finally, 
$\chi''(x) = \chi'(x)$ for any vertex $x$ not in $G_{\chi'}[c']$.

$\chi''$ is convex, 
since all vertices in $G_{\chi'}[c']$ are colored by different colors. 
%
$\chi''$ recolors at most as many vertices as $\chi'$, 
since it may recolor $u$'s mate (if it exists), 
but it avoids the recoloring of $v$. 
%
Finally, 
$\chi''$ retains more colors than $\chi'$, 
since it retains $c$.
%
Thus, 
we obtained an optimal recoloring that retains more colors than $\chi'$.  
%
A contradiction.
\end{proof}

Next we show that we need not recolor connected pairs.

\begin{lemma}
\label{lm:does_not_recolor_connected_pair}
For every colored graph $G_\chi$ there exists a retains-all,
optimal,
convex recoloring that does not recolor any connected pair.
\end{lemma}

\begin{proof}
Consider an optimal retains-all convex recoloring $\chi'$ 
that retains the maximum number of connected pairs, 
over all optimal, 
retains-all recolorings of $G$.  
%
Assume for contradiction that $\chi'$ 
recolors one of the vertices of a connected pair $\{u, v\}$, 
that is, 
w.l.o.g., 
$\chi(u) = c$ and $\chi'(v) = c' \neq c$.
%
We can use a similar argument to the one used in the proof of Lemma~\ref{lm:retains-all}.
%
The difference is in the definition of $\chi''$.  
%
If $G_{\chi'}[c']$ contains a connected pair $u_1, u_2$ 
such that $\chi(u_1) = \chi(u_2) = c'$, 
then we define $\chi''(u_1) = \chi''(u_2) = c'$.
%
Observe that $\chi''$ is convex since all vertices in $G_{\chi'}[c']$
are colored using different colors,
with the exception of $u$ and $v$ which are colored by $c$,
and $u_1$ and $u_2$ which are colored by $c'$ if they exist. 
%
Observe also that $\chi''$ recolors at most as many vertices as $\chi'$, 
and retains more connected pairs than $\chi'$. 
%
A contradiction.
\end{proof}

We are now ready to define \emph{path-recolorings}.
%
Given a colored graph $G_\chi$ and a convex recoloring $\chi'$, 
we say that $\chi'$ \emph{path-recolors} $G$ with respect to $c \in C$ 
if the vertices of $G_{\chi'}[c]$ form a simple path: 
$u, \dots, v$ such that $\chi(u) = \chi(v) = c$.
%
A special case of this definition is when  $G_{\chi'}[c]$ 
is a single vertex $v$ and $\chi(v) = c$.
%
We say that $\chi'$ is a \emph{path-recoloring} if:
\begin{enumerate}
	\item $\chi'$ does not recolor any connected pair, and 
	\item $\chi'$ path-recolors $G$ with respect to every $c \in C$.
\end{enumerate}
Clearly, every path recoloring, also retains all colors.

\begin{lemma}
\label{lm:optimal_path_recoloring}
For every colored graph $G_\chi$ 
there exists an optimal recoloring that is a path recoloring.
\end{lemma}

\begin{proof}
Let $\chi'$ be an optimal, 
retains-all recoloring that does not recolor any connected pair 
(whose existence was shown in Lemma~\ref{lm:does_not_recolor_connected_pair}) 
that path-recolors $G$ with the maximum possible number of colors in $C$. 
%
Assume for contradiction that $\chi'$ is not a path-recoloring.  
%
Hence there is a color $c$ such that $\chi'$ does not path-recolor $G$ with $c$.
%
Consider $G_{\chi'}[c]$, 
and assume for now that there are two vertices $u$
and $v$ in $G_{\chi'}[c]$ such that $\chi(u) = \chi(v) = c$.  
%
Fix a simple path from $u$ to $v$ in $G_{\chi'}[c]$, 
and let $\chi''$ be identical to $\chi'$ with the following modification: 
$\chi''$ assigns a unique color for every vertex in $G_{\chi'}[c]$ 
that is not on the simple path from $u$ to $v$.
%
Clearly, 
$\chi''$ is an optimal recoloring that path-recolors $G$ with more colors than $\chi'$.  
%
A contradiction.
	
Now,
if there is at most one vertex $v$ in $G_{\chi'}[c]$ such that $\chi(v) = c$ 
then consider a recoloring $\chi''$ that is identical to $\chi'$ 
except it assigns a unique color to every vertex in $G_{\chi'}[c]$ that is not $v$.
%
This time, 
again, 
we found an optimal recoloring that path-recolors $G$ with more colors than $\chi'$.  
%
A contradiction.
\end{proof}

Henceforth, 
whenever we refer to a recoloring, 
we assume that it is a path-recoloring, 
in particular, 
we assume that for every disconnected pair in $G$ with color $c$, 
a recoloring either:
\begin{inparaenum}[(i)]
	\item colors a path between the disconnected pair with a color $c$.
	\item colors exactly one of its vertices. 
\end{inparaenum}

\subsection{Path Independence}

When a recoloring colors a path between disconnected pair, 
we refer to the path as a \emph{colored path}.
%
Let $D$ be the set of all disconnected pairs in $G$, 
and denote by $I$ the set of colored paths in $G_{\chi'}$, 
then the following lemma holds:

\begin{lemma}
\label{lm:cost}
Given a colored graph $G_\chi$, 
a path-recoloring $\chi'$ recolors exactly $|D| - |I|$ vertices.
\end{lemma}

\begin{proof}
By definition,
$\chi'$ does not recolor any of the pairs that form the endpoints of paths in $I$.
%
$\chi'$ must recolor exactly one vertex of every other disconnected pair:
if it recolors both vertices then the color of this pair is not retained,
and if it recolors none of them then convexity does not hold.
\end{proof}

Given a colored graph $G_\chi$ and a path $p$, 
let $V(p)$ be the set of vertices on the path and let $\chi(p)$ 
be the set of colors assigned to vertices on this path, 
i.e. $\chi(p) = {\{\chi(v) : v \in V(p)\}}$.
%
Given two paths $p_1$ and $p_2$ in $G_\chi$:
\begin{itemize}
\item 
$p_1$ and $p_2$ are in \emph{direct conflict} if $V(p_1) \cap V(p_2) \neq \emptyset$.

\item 
$p_1$ and $p_2$ are in \emph{indirect conflict} if $\chi(p_1) \cap \chi(p_2) \neq \emptyset$,
\end{itemize}
%
$p_1$ and $p_2$ are in \emph{conflict} if they are either in a direct
or indirect conflict (observe that two paths can be both in direct and
indirect conflicts).
%
If two paths are not in conflict, 
then they are \emph{independent}.
%
Given a set of paths $I$, 
we say that this set is \emph{independent}
if it is pairwise independent, 
that is, 
if every two paths $p_1, p_2 \in I$ are independent.
%
A path $u, \dots, v$ in $G$ is called \emph{colorable} if $u$ and $v$
form a disconnected pair and the path does not contain singletons nor
vertices of connected pairs.
%
Figure~\ref{fig:paths} depicts these concepts.

\begin{figure}[t]
\centering

\begin{tikzpicture}[]
\node(1) at (-3,1) [colored node, red node] {1}; 
\node(2) at (-3,-1) [colored node, red node] {2}; 
\node(3) at (3,1) [colored node, blue node] {3}; 
\node(4) at (3,-1) [colored node, blue node] {4}; 
\node (5) at (-2,0) [colored node, green node] {5}; 
\node (6) at (2, 0) [colored node, green node] {6};
\node (7) at (0,0) [colored node, black node] {7}; 

\draw (3) -- (6); 
\draw (7) -- (6);
\draw (7) -- (5);
\draw (6) -- (4);
\draw (5) -- (2);
\draw (1) -- (5);
\end{tikzpicture}

\caption{
\label{fig:paths}
In this colored graph, the paths (4, 6, 3) and (1, 5, 2) are colorable, while
the path (6, 7, 5) is not.
Path (4, 6, 3) is in indirect conflict with path (1, 5, 2) and in direct
conflict with path (6, 7, 5)
}
\end{figure}

In the next lemma we show that the set of colored paths that is
induced by a path-recoloring is an independent set of colorable paths.

\begin{lemma}
\label{lm:independent}
Let $G_\chi$ be a colored graph.
%
Also, 
let $\chi'$ be a path-recoloring,
and let $I$ denote the set of colored paths (w.r.t.\ $\chi'$).  
%
Then $I$ is an independent set of colorable paths with respect to $\chi$.
\end{lemma}

\begin{proof}
Obviously, 
two colored paths in $I$ cannot be in direct conflict.
%
Assume for contradiction that there are two paths $p_1, p_2 \in I$
that are in indirect conflict, 
that is, 
there is a color $c \in \chi(p_1) \cap \chi(p_2)$.
%
It follows that $\chi'$ recolors two vertices of the same color, 
and we get a contradiction since $\chi'$ does not retain all colors.
%
Finally, 
it follows that all colored paths are colorable with respect to $\chi$, 
or otherwise $\chi'$ must recolor a singleton or a connected pair.
\end{proof}

We say that a set of paths, $I$, \emph{covers} a pair if at least one of the
vertices of the pair belongs to one of the paths in $I$.

\begin{lemma}
\label{lm:independent_set_is_recoloring}
For any independent set of colorable paths $I$ in $G_{\chi}$, 
there exists a convex path-recoloring $\chi'$ of $G$, 
where $I$ is the set of colored path.
\end{lemma}

\begin{proof}
Consider a recoloring $\chi'$ that colors every colorable path in $I$
using the color of its endpoints and assigns a unique new color for
every disconnected pair that is not covered by $I$.
%
We first show that $\chi'$ is a path recoloring.  
%
Since $I$ is independent, 
no two paths in $I$ contain the same color, moreover,
every path in $I$ is colorable, 
thus it does not contain singletons, 
and it follows that $\chi'$ retains all colors.  
%
Also, every path in $I$ does not contain any vertices of connected pairs, 
thus $I$ does not recolor vertices of connected pairs.
%
Finally, by the construction of $\chi'$, 
it is not hard to verify that for every color $c \in C$,
the subgraph $G_{\chi'}[c]$ is either a simple path or a single vertex.
%
Further observe that for every color $c \in \text{Image}(\chi')$,
$G_{\chi'}[c]$ is either a simple path or a single vertex, and it
follows that $\chi'$ is a convex recoloring.  
%
Finally, by the
construction of $\chi'$, it is straightforward to verify that $I$ is
the set of colored paths induced by $\chi'$.
\end{proof}

The following is obtained due to  Lemmas~\ref{lm:cost}, 
\ref{lm:independent} and~\ref{lm:independent_set_is_recoloring}.

\begin{theorem}
\label{th:independent_set}
Given a colored graph $G_\chi$ the cost of an optimal
(path-)recoloring is $|D| - s$ if and only if the size of the maximum
independent set of colorable paths is $s$.
\end{theorem}

Theorem~\ref{th:independent_set} suggests an alternative definition to \TWOCR{}: 
given a colored graph $G_\chi$, 
find a maximum independent set of colorable paths in $G_\chi$.
